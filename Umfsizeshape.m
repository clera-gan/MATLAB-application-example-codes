function umffitting
clear all
clc

ap=[0.25 0.5 0.75 1.0 1.5 2.0 2.5 3.0 3.5]';
dp=1e-6*[10 25 50 100 500];
dpi=ones(9,1)*dp;
phi=[0.696	0.91157471	0.985	0.999999	0.973387526	0.929	0.886291095	0.847880295	0.814]';
sph=ap*ones(1,5);
umf=[0.00009	2.60E-04	0.00075	0.0025	0.1
0.0001	2.15E-04	0.00065	0.0022	0.07
0.000063	1.32E-04	0.0008	0.00275	0.08
0.000078	2.75E-04	0.0012	0.005	0.13
0.000067	1.58E-04	0.00083	0.003	0.09
0.000092	2.90E-04	0.001	0.0033	0.1
0.000155	4.00E-04	0.0013	0.00425	0.12
0.000202	5.40E-04	0.00168	0.0055	0.15
0.000253	6.98E-04	0.0023	0.01	0.186];

por=[0.524629	0.46131	0.426539	0.409379	0.398351
0.452179	0.38792	0.367349	0.347533	0.348384
0.425623	0.339024 0.361106	0.357503	0.344813
0.432953	0.38936	0.389869	0.38519	0.38031
0.431643	0.335177 0.352153	0.342409	0.335708
0.444107	0.36972	0.358559	0.353619	0.335106
0.46578  	0.39108	0.368729	0.356457	0.346445
0.472498	0.42106	0.388242	0.371934	0.362452
0.483408	0.44532	0.400889	0.390388	0.383729];


%plot(por,umf)

whos ap dpi sph umf por

k0=[0.01 0.3]; 
c1=(1349.5-1.25)*9.81/1.8e-5;
[k,resnorm,residual,exitflag,output,lambda,jacobian] = lsqnonlin(@fun,k0,[],[],[],umf,por,sph,dpi);
k
residual;

%oblate 
c1=(1349.5-1.25)*9.81/1.8e-5;
porfit=c1*k(1)*por.^3.*sph.^k(2).*dpi.^2./(ones(9,5)-por);
k1=1/k(1)
plot(-log(umf), -log(porfit), '*')

%-----------------------------------
function f=fun(k,umf,por,sph,dpi)
%k=[k(1) k(2) k(3)]
c1=(1349.5-1.25)*9.81/1.8e-5;
f=umf-(c1*k(1)*por.^3.*sph.^k(2).*dpi.^2./(ones(9,5)-por));

